- content_for :head do
  = javascript_include_tag "pages/student/notes/index-bundle"
  = stylesheet_link_tag "pages/student/notes/index-bundle", :media => "all"

.container
  .lib-content
    #operation-div.col-lg-12.form-inline
      .col-lg-2
        %span 科目：
        = select_tag "search_subject", options_for_select(Subject::CODE_WITH_ALL, params[:subject].to_i), class: "form-control", id: "subject-select"
      .col-lg-3
        %span 时间：
        = select_tag "search_period", options_for_select(time_period, params[:period].to_i), class: "form-control", id: "period-select"
      - if @questions.present?
        .col-lg-7
          .btn-group.right
            = link_to "练习", { controller: "student/questions", action: "exercise", type: "button" }, :method => "get", :class => 'btn btn-primary' 
            = link_to "答案", "javascript:void(0)", :method => "get", :class => 'btn btn-primary show-answer-btn'
            = link_to "导出", "javascript:void(0)", :method => "get", :class => 'btn btn-primary', data: {toggle: "modal", target: "#export"}
    - if @questions.blank?
      %span 没有找到符合条件的错题
    - else
      - @questions.each do |q|
        - next if q.nil?
        .question-div.col-lg-12
          .question-content-div
            .question-content
              = render :partial => "partials/question_content", locals: { content: q.content }
            - if q.type == "choice"
              .question-items
                - q.items.each_with_index do |item, index|
                  %p
                    %label= d2c(index) + ". "
                    %span= item.render_question.html_safe
            .question-answer.hide
              - if q.type == "choice" && q.answer.present?
                %strong.answer-label= "解答: #{d2c(q.answer)}"
              - else
                %strong.answer-label= "解答:"
              .question-answer-content
                = render :partial => "partials/question_content", locals: { content: q.answer_content }
          = link_to student_note_path(q), method: "delete", class: "close-btn", confirm: "确定删除？" do
            = image_tag "close_button.png", size: "20x20"
          .clear-both

#export.modal.fade
  .modal-dialog
    .modal-content
      .modal-header
        #export-notification.jesse-notification
          %span
        %button.close{type: "button", "data-dismiss" => "modal", "aria-hidden" => "true"} &times;
        %h3 导出word
      .modal-body
        .form-group
          %label
            %input#download-radio{name: "export-type", checked: false, type: "radio", value: "download"}/
            直接下载
          %label
            %input#email-radio{name: "export-type", checked: true, type: "radio", value: "email"}/
            发送至邮箱
          %input#email-input.form-control{placeholder: "输入邮箱地址", type: "email", value: "#{current_user.email}"}/
        .form-group
          %label
            %input#answer-checkbox{checked: false, type: "checkbox"}/
            包含答案
      .modal-footer
        %a.btn.btn-default{href: "#", data: {dismiss: "modal"}, "aria-hidden" => "true"} 取消
        %a#export-btn.btn-primary.btn.btn-default{href: "#", "aria-hidden" => "true"} 导出

#download.modal.fade
  .modal-dialog
    .modal-content
      .modal-header
        %button.close{type: "button", "data-dismiss" => "modal", "aria-hidden" => "true"} &times;
        %h3 导出完成
      .modal-body
        %p
          %span 导出完成，浏览器将自动下载结果，您也可以
          %a{href: "#"} 点击此处
          %span 手动下载
      .modal-footer
        %a.btn.btn-default.btn-primary{href: "#", data: {dismiss: "modal"}, "aria-hidden" => "true"} 关闭

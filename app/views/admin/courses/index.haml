- content_for :head do
  = javascript_include_tag "pages/admin/courses-bundle"
  = stylesheet_link_tag "pages/admin/courses-bundle", :media => "all"
  :javascript

.container
  .lib-content
    - if @courses["data"].blank?
      %h4
        没有课程
    - else
      .paginator-wrapper
        = paginator_mini @courses
      %table#course-table.table.table-striped
        %tr
          %th.col-md-1= "教师"
          %th.col-md-1= "科目"
          %th.col-md-1= "名称"
          %th.col-md-1= "起始时间"
          %th.col-md-1= "结束时间"
          %th.col-md-1= "年级"
          %th.col-md-2= "简介"
          %th.col-md-1= "建议学时"
          %th.col-md-1= "讲义封面"
          %th.col-md-2 操作
        - @courses["data"].each do |c|
          %tr
            %td= c.teacher.name
            %td= Subject::NAME[c.subject]
            %td= c.name
            %td= Time.at(c.start_at).strftime("%Y-%m-%d")
            %td= Time.at(c.end_at).strftime("%Y-%m-%d")
            %td= c.grade
            %td= c.desc
            %td= c.suggestion
            %td
              =image_tag(c.textbook_url)
            %td
              = link_to "删除", { controller: "admin/courses", action: "destroy", id: c._id.to_s }, :method => "delete", :class => 'btn btn-danger btn-xs'
              = link_to "内容", { controller: "admin/lessons", action: "index", course_id: c._id.to_s }, :class => 'btn btn-primary btn-xs'
              - if c.ready
                = link_to "下架", { controller: "admin/courses", action: "toggle_ready", id: c._id.to_s }, method: "put", :class => 'btn btn-primary btn-xs'
              - else
                = link_to "上架", { controller: "admin/courses", action: "toggle_ready", id: c._id.to_s }, method: "put", :class => 'btn btn-primary btn-xs'
    %button.btn.btn-new.btn-primary{data: {toggle: "modal", target: "#newCourse"} } 创建新课程

#newCourse.modal.fade
  .modal-dialog
    .modal-content
      = form_tag(admin_courses_path, method: "post", multipart: true) do
        .modal-header
          %button.close{type: "button", "data-dismiss" => "modal", "aria-hidden" => "true"} &times;
          %h3 创建新课程
        .modal-body
          .form-group
            = label_tag :teacher, "教师"
            = select_tag "course[teacher_id]", options_for_select(User.tablet_teachers, -1), class: "form-control"
          .form-group
            = label_tag :subject, "学科"
            = select_tag "course[subject]", options_for_select(Subject::CODE, 4), class: "form-control"
          .form-group
            = label_tag :subject, "名称"
            = text_field_tag "course[name]", "", autofocus: true, class: "form-control"
          .form-group
            = label_tag :start_at, "起始时间（形如 2015/7/1）"
            = text_field_tag "course[start_at]", "", autofocus: true, class: "form-control"
          .form-group
            = label_tag :start_at, "结束时间（形如 2015/7/1）"
            = text_field_tag "course[end_at]", "", autofocus: true, class: "form-control"
          .form-group
            = label_tag :start_at, "年级"
            = text_field_tag "course[grade]", "", autofocus: true, class: "form-control"
          .form-group
            = label_tag :start_at, "简介"
            = text_field_tag "course[desc]", "", autofocus: true, class: "form-control"
          .form-group
            = label_tag :start_at, "建议学时"
            = text_field_tag "course[suggestion]", "", autofocus: true, class: "form-control"
          .form-group
            = label_tag :textbook_url, "讲义封面"
            = file_field_tag "textbook"
        .modal-footer
          %a.btn.btn-default{href: "#", data: {dismiss: "modal"}, "aria-hidden" => "true"} 取消
          = submit_tag "创建", :class => 'btn-primary btn'
